<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.everygamer.orm.dao.ItemListStatisDao">
    <insert id="addStatis">
        INSERT INTO item_list_statistics (`name`, itemType, manufactor, model, `count`, price, exData, `upDate`)
        VALUES
            (#{param1}, #{param2}, #{param3}, #{param4}, #{param5}, #{param6} * #{param5}, #{param7}, UNIX_TIMESTAMP())
    </insert>
    <update id="updateStatis">
        UPDATE item_list_statistics
        SET `count` = `count` + #{param2}, price = price + #{param3} * #{param2}, `upDate` = UNIX_TIMESTAMP()
        WHERE id = #{param1}
    </update>
    <update id="mergeExData">
        UPDATE item_list_statistics
        SET exData = JSON_MERGE(exData, #{param2}), `upDate` = UNIX_TIMESTAMP()
        WHERE itemType = #{param1}
    </update>
    <update id="splitItem">
        UPDATE item_list_statistics
        SET `count` = `count` - #{param5}, price = price - #{param6}
        WHERE `name` = #{param1} AND itemType = #{param2} AND manufactor = #{param3} AND model = #{param4} AND
              exData = #{param7}
    </update>
    <select id="isExist" resultType="com.everygamer.bean.BaseItem">
        SELECT id
        FROM item_list_statistics
        WHERE
            `name` = #{param1} AND itemType = #{param2} AND manufactor = #{param3} AND model = #{param4} AND
            exData = #{param5}
    </select>
</mapper>