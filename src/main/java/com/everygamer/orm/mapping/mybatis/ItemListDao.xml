<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.everygamer.orm.dao.ItemListDao">
    <insert id="addItem">
        INSERT INTO item_list (`name`, itemType, manufactor, model, `count`, price, exData, `desc`, insDate)
        VALUES
            (#{param1}, #{param2}, #{param3}, #{param4}, #{param5}, #{param6}, #{param7}, #{param8},
             UNIX_TIMESTAMP())
    </insert>
    <update id="mergeExData">
        UPDATE item_list
        SET exData = JSON_MERGE(exData, #{param2}), `upDate` = UNIX_TIMESTAMP()
        WHERE itemType = #{param1}
    </update>
    <delete id="delItem">
        UPDATE item_list
        SET isAlive = 0
        WHERE id = #{param1};
    </delete>
    <select id="getItemByName" resultType="com.everygamer.bean.BaseItem">
        SELECT
            item_list.id,
            item_list.name,
            item_type.name                    AS itemType,
            item_list.model,
            item_list.count,
            item_list.price,
            FROM_UNIXTIME(item_list.insDate)  AS insDate,
            FROM_UNIXTIME(item_list.`upDate`) AS 'upDate'
        FROM item_list
            LEFT JOIN item_type ON item_list.itemType = item_type.id
        WHERE item_list.name = #{param1} AND item_list.count > 0 AND item_list.isAlive = 1
        ORDER BY item_list.insDate
    </select>
    <select id="getExDataByType" resultType="java.lang.String">
        SELECT exData
        FROM item_list
        WHERE itemType = #{param1}
        LIMIT 1
    </select>
    <select id="getItemById" resultType="com.everygamer.bean.BaseItem">
        SELECT *
        FROM item_list
        WHERE id = #{param1}
    </select>
</mapper>